<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SelfMap Teens</title>
  <style>
    /* ------------------------------
       ベースデザイン
    ------------------------------ */
    :root {
      --bg-main: #050914;
      --bg-panel: rgba(18, 32, 66, 0.98);
      --bg-panel-soft: rgba(18, 32, 66, 0.9);
      --accent: #4fd2ff;
      --accent-soft: #9be4ff;
      --text-main: #f5f7ff;
      --text-sub: #c7d4ff;
      --border-soft: rgba(138, 187, 255, 0.45);
      --shadow-soft: 0 14px 28px rgba(0, 0, 0, 0.75);
      --radius-card: 18px;
      --font-jp: "Hiragino Maru Gothic Pro", "Yu Gothic", "Meiryo",
        system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-jp);
      color: var(--text-main);
      background: radial-gradient(circle at top, #273561 0, #050914 60%);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    main {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 16px 64px;
    }

    h1,
    h2,
    h3 {
      margin: 0 0 16px;
      text-align: center;
      letter-spacing: 2px;
    }

    h1 {
      font-size: 32px;
    }

    h2 {
      font-size: 24px;
    }

    p {
      margin: 0;
    }

    .lead {
      text-align: center;
      margin-top: 8px;
      margin-bottom: 24px;
      color: var(--text-sub);
      line-height: 1.7;
    }

    /* ------------------------------
       ボタン
    ------------------------------ */
    .center-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 28px;
    }

    .btn-primary,
    .btn-secondary {
      min-width: 220px;
      padding: 12px 24px;
      border-radius: 999px;
      border: 1px solid rgba(120, 195, 255, 0.8);
      background: linear-gradient(135deg, #35b4ff, #5ae0ff);
      color: #021019;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.6);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        filter 0.12s ease, background 0.12s ease;
    }

    .btn-secondary {
      background: transparent;
      color: var(--accent-soft);
      border-color: rgba(138, 187, 255, 0.7);
      box-shadow: none;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.8);
      filter: brightness(1.03);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.7);
      background: rgba(79, 210, 255, 0.1);
    }

    /* ------------------------------
       画面の切り替え
    ------------------------------ */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* ------------------------------
       カード（マップ画面）
    ------------------------------ */
    /* ====== マップ画面：カードレイアウト ====== */
#island-grid {
    display: flex;
    flex-wrap: nowrap;         /* 横一列に並べる */
    justify-content: center;   /* 真ん中に集める */
    gap: 32px;                 /* カード同士の間隔 */
    margin-top: 32px;
    overflow-x: auto;          /* 横スクロール許可 */
    padding-bottom: 16px;
}

/* ====== カードのサイズ ====== */
.island-card {
    flex: 0 0 210px;           /* カード幅固定（並ぶ） */
}

    .map-container {
      margin-top: 32px;
    }

    .island-grid {
      display: flex;
      justify-content: center;
      align-items: stretch;
      gap: 24px;
      margin-top: 24px;
      flex-wrap: nowrap; /* PC では1列に */
      overflow-x: auto;  /* 画面が狭いときだけ横スクロール */
      padding-bottom: 8px;
    }

    .island-grid::-webkit-scrollbar {
      height: 6px;
    }

    .island-grid::-webkit-scrollbar-thumb {
      background: rgba(130, 170, 230, 0.7);
      border-radius: 999px;
    }

    .island-card {
      flex: 0 0 210px;
      background: radial-gradient(circle at top, #273561 0, #101b35 60%);
      border-radius: var(--radius-card);
      padding: 18px 18px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-soft);
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        border-color 0.12s ease, background 0.12s ease;
      color: var(--text-main);
    }

    .island-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.9);
      border-color: rgba(164, 220, 255, 0.9);
      background: radial-gradient(circle at top, #334b8a 0, #101b35 60%);
    }

    .island-name-en {
      font-size: 12px;
      letter-spacing: 2px;
      color: var(--accent-soft);
      margin-bottom: 4px;
    }

    .island-name-jp {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .island-desc {
      font-size: 13px;
      color: var(--text-sub);
      line-height: 1.6;
      min-height: 56px;
    }

    .progress-row {
      margin-top: 16px;
      font-size: 11px;
      color: var(--accent-soft);
    }

    .progress-bar {
      margin-top: 6px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(17, 40, 75, 0.9);
      overflow: hidden;
      position: relative;
    }

    .progress-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, #4fd2ff, #9be4ff);
      transition: width 0.25s ease;
    }

    /* ------------------------------
       スタート画面
    ------------------------------ */
    .quote-box {
      margin: 32px auto 0;
      max-width: 680px;
      padding: 20px 24px;
      border-radius: 20px;
      background: radial-gradient(circle at top, #273561 0, #101321 55%);
      border: 1px solid rgba(138, 187, 255, 0.4);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
      color: var(--text-sub);
      line-height: 1.8;
      font-size: 14px;
    }

    .quote-text {
      margin-bottom: 6px;
    }

    .quote-author {
      text-align: right;
      font-size: 13px;
      color: var(--accent-soft);
    }

    /* ------------------------------
       質問画面
    ------------------------------ */
    .question-header {
      margin-bottom: 24px;
    }

    .question-title {
      font-size: 20px;
      text-align: center;
      margin-bottom: 6px;
    }

    .question-tagline {
      text-align: center;
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 20px;
    }

    .question-progress {
      text-align: center;
      font-size: 12px;
      color: var(--accent-soft);
    }

    .question-list {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .question-item {
      background: var(--bg-panel-soft);
      border-radius: 16px;
      padding: 12px 14px 10px;
      border: 1px solid rgba(110, 150, 230, 0.4);
    }

    .question-label {
      font-size: 13px;
      margin-bottom: 6px;
      color: var(--text-sub);
    }

    .question-input {
      width: 100%;
      min-height: 46px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid rgba(110, 150, 230, 0.6);
      background: rgba(3, 10, 25, 0.9);
      color: var(--text-main);
      padding: 8px 10px;
      font-family: var(--font-jp);
      font-size: 13px;
    }

    .question-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(79, 210, 255, 0.7);
    }

    /* ------------------------------
       旅のまとめ画面
    ------------------------------ */
    .summary-section {
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }

    .summary-card {
      background: var(--bg-panel-soft);
      border-radius: 18px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(138, 187, 255, 0.45);
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.7);
    }

    .summary-title {
      font-size: 14px;
      letter-spacing: 1px;
      color: var(--accent-soft);
      margin-bottom: 4px;
    }

    .summary-sub {
      font-weight: 700;
      margin-bottom: 10px;
    }

    .summary-body {
      font-size: 13px;
      line-height: 1.7;
      color: var(--text-sub);
      white-space: pre-wrap;
    }

    /* ------------------------------
       レスポンシブ
    ------------------------------ */
    @media (max-width: 960px) {
      main {
        padding-top: 28px;
      }

      h1 {
        font-size: 26px;
      }

      .island-grid {
        flex-wrap: wrap; /* 画面が狭いときは折り返しOK */
        justify-content: center;
      }

      .island-card {
        flex: 0 0 45%;
        max-width: 260px;
      }
    }

    @media (max-width: 640px) {
      .island-card {
        flex: 0 0 100%;
        max-width: 360px;
      }

      .quote-box {
        padding: 16px 18px;
      }
    }
  </style>
</head>
<body>
  <main>
    <!-- スタート画面 -->
    <section id="screen-start" class="screen active">
      <h1>SelfMap Teens</h1>
      <p class="lead">
        Know your inner world. / あなたの内側を知る旅へ。
      </p>

      <div class="quote-box" id="quote-box">
        <div class="quote-text" id="quote-text">
          読み込み中…
        </div>
        <div class="quote-author" id="quote-author"></div>
      </div>

      <div class="center-buttons">
        <button id="btn-start" class="btn-primary">
          旅を始める（Start Your Journey）
        </button>
      </div>
    </section>

    <!-- マップ画面 -->
    <section id="screen-map" class="screen">
      <h2>SelfMap Ocean</h2>
      <p class="lead">
        気になる島から、いつでも好きな順番で上陸してOK。<br />
        すべての島で書き終わると、「旅のまとめ」が開きます。
      </p>

      <div class="map-container">
        <div id="island-grid" class="island-grid"></div>
      </div>

      <div class="center-buttons">
        <button id="btn-go-summary" class="btn-secondary">
          旅のまとめ画面へ
        </button>
        <button id="btn-back-start" class="btn-secondary">
          スタート画面に戻る
        </button>
      </div>
    </section>

    <!-- 質問画面 -->
    <section id="screen-questions" class="screen">
      <div class="question-header">
        <div class="question-title" id="question-title"></div>
        <div class="question-tagline" id="question-tagline"></div>
        <div class="question-progress" id="question-progress-text"></div>
      </div>

      <div id="question-list" class="question-list"></div>

      <div class="center-buttons">
        <button id="btn-back-map" class="btn-secondary">
          マップに戻る
        </button>
        <button id="btn-save-image" class="btn-secondary">
          この島を画像として保存（PNG）
        </button>
      </div>
    </section>

    <!-- 旅のまとめ画面 -->
    <section id="screen-summary" class="screen">
      <h2>旅のまとめ</h2>
      <p class="lead">
        各島で書いたことを、あとからゆっくり眺められるページです。<br />
        「いまの自分のものがたり」を、いつでも思い出せますように。
      </p>

      <div id="summary-section" class="summary-section"></div>

      <div class="center-buttons">
        <button id="btn-summary-back-map" class="btn-secondary">
          マップ画面に戻る
        </button>
        <button id="btn-summary-back-start" class="btn-secondary">
          スタート画面に戻る
        </button>
        <button id="btn-summary-print" class="btn-primary">
          このページを印刷 / PDF保存
        </button>
      </div>
    </section>
  </main>

  <!-- html2canvas（PNG保存用）CDN -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    /* ------------------------------
       名言データ
    ------------------------------ */
    const quotes = [
      {
        text: "千里の道も、一歩から。",
        author: "老子"
      },
      {
        text: "未来とは、今である。",
        author: "サン＝テグジュペリ"
      },
      {
        text: "自分の物語の主人公は、いつだって自分自身だ。",
        author: "SelfMap Teens"
      },
      {
        text: "完璧じゃなくていい。動き出した分だけ、世界は変わる。",
        author: "SelfMap Teens"
      }
    ];

    function pickRandomQuote() {
      const q = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById("quote-text").textContent = `「${q.text}」`;
      document.getElementById("quote-author").textContent = `— ${q.author}`;
    }

    /* ------------------------------
       島データと質問
    ------------------------------ */
    const questionsData = {
      personal: {
        key: "personal",
        en: "PERSONAL ISLAND",
        jp: "パーソナル島",
        desc: "自分ってこういう人かも？ をゆっくり見つける旅。",
        tagline: "自分の性格・クセ・パターンなど、「自分ってこういう人かな？」を言葉にしていく島。",
        questions: Array.from({ length: 20 }).map(
          (_, i) => `パーソナルの質問 ${i + 1}`
        )
      },
      future: {
        key: "future",
        en: "FUTURE ISLAND",
        jp: "フューチャー島",
        desc: "「これからどうしたい？」を言葉にしてみる旅。",
        tagline: "高校生活・進路・1年後の自分など、これからの道について考える島。",
        questions: Array.from({ length: 20 }).map(
          (_, i) => `フューチャーの質問 ${i + 1}`
        )
      },
      adult: {
        key: "adult",
        en: "ADULT ISLAND",
        jp: "アダルト島",
        desc: "「理想の大人像」をゆっくり描いていく旅。",
        tagline: "どんな大人になりたいか、どんな生き方をしたいかを考える島。",
        questions: Array.from({ length: 20 }).map(
          (_, i) => `アダルトの質問 ${i + 1}`
        )
      },
      wish: {
        key: "wish",
        en: "WISH ISLAND",
        jp: "ウィッシュ島",
        desc: "遠慮せずに、願いごとをたくさん並べてみる旅。",
        tagline: "小さな願いから、ちょっと大きな夢まで、心の「こうなったらいいな」を集める島。",
        questions: Array.from({ length: 20 }).map(
          (_, i) => `ウィッシュの質問 ${i + 1}`
        )
      },
      worry: {
        key: "worry",
        en: "WORRY ISLAND",
        jp: "ウォーリー島",
        desc: "不安と上手につき合う方法を探す旅。",
        tagline: "心配ごとや不安を書き出して、「どう付き合うか」を考える島。",
        questions: Array.from({ length: 20 }).map(
          (_, i) => `ウォーリーの質問 ${i + 1}`
        )
      }
    };

    const islandOrder = ["personal", "future", "adult", "wish", "worry"];

    /* ------------------------------
       状態管理
    ------------------------------ */
    let currentScreen = "start";
    let currentIslandKey = null;

    // 回答は localStorage に保存
    const STORAGE_KEY = "selfmap_teens_answers_v1";

    function loadAnswers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) {
        return {};
      }
    }

    function saveAnswers(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    let answers = loadAnswers();

    function getIslandAnswers(key) {
      if (!answers[key]) answers[key] = {};
      return answers[key];
    }

    /* ------------------------------
       画面切り替え
    ------------------------------ */
    function showScreen(id) {
      document
        .querySelectorAll(".screen")
        .forEach((el) => el.classList.remove("active"));
      document.getElementById(`screen-${id}`).classList.add("active");
      currentScreen = id;
    }

    /* ------------------------------
       マップ画面の描画
    ------------------------------ */
    function calcProgressPercent(islandKey) {
      const island = questionsData[islandKey];
      const ans = getIslandAnswers(islandKey);
      const total = island.questions.length;
      const filled = island.questions.filter((_, index) => {
        const v = ans[index] ?? "";
        return String(v).trim().length > 0;
      }).length;
      return {
        filled,
        total,
        percent: total === 0 ? 0 : Math.round((filled / total) * 100)
      };
    }

    function renderMap() {
      const grid = document.getElementById("island-grid");
      grid.innerHTML = "";

      islandOrder.forEach((key) => {
        const island = questionsData[key];
        const prog = calcProgressPercent(key);

        const card = document.createElement("div");
        card.className = "island-card";
        card.dataset.key = key;

        card.innerHTML = `
          <div class="island-name-en">${island.en}</div>
          <div class="island-name-jp">${island.jp}</div>
          <div class="island-desc">${island.desc}</div>
          <div class="progress-row">
            進捗：${prog.filled} / ${prog.total}（${prog.percent}%）
            <div class="progress-bar">
              <div class="progress-bar-fill" style="width:${prog.percent}%;"></div>
            </div>
          </div>
        `;

        card.addEventListener("click", () => {
          openIsland(key);
        });

        grid.appendChild(card);
      });
    }

    /* ------------------------------
       質問画面の描画
    ------------------------------ */
    function openIsland(key) {
      currentIslandKey = key;
      const island = questionsData[key];
      const islandAns = getIslandAnswers(key);

      document.getElementById(
        "question-title"
      ).textContent = `${island.jp} / ${island.en}`;
      document.getElementById("question-tagline").textContent =
        island.tagline;

      const list = document.getElementById("question-list");
      list.innerHTML = "";

      island.questions.forEach((q, index) => {
        const wrapper = document.createElement("div");
        wrapper.className = "question-item";

        const label = document.createElement("div");
        label.className = "question-label";
        label.textContent = `Q${index + 1}. ${q}`;

        const textarea = document.createElement("textarea");
        textarea.className = "question-input";
        textarea.value = islandAns[index] ?? "";

        textarea.addEventListener("input", () => {
          islandAns[index] = textarea.value;
          saveAnswers(answers);
          updateQuestionProgress();
          renderMap(); // マップの進捗バーも更新
        });

        wrapper.appendChild(label);
        wrapper.appendChild(textarea);
        list.appendChild(wrapper);
      });

      updateQuestionProgress();
      showScreen("questions");
    }

    function updateQuestionProgress() {
      if (!currentIslandKey) return;
      const prog = calcProgressPercent(currentIslandKey);
      const text = document.getElementById("question-progress-text");
      text.textContent = `進捗：${prog.filled} / ${prog.total}（${prog.percent}%）`;
    }

    /* ------------------------------
       旅のまとめ画面の描画
    ------------------------------ */
    function renderSummary() {
      const container = document.getElementById("summary-section");
      container.innerHTML = "";

      islandOrder.forEach((key) => {
        const island = questionsData[key];
        const islandAns = getIslandAnswers(key);

        const card = document.createElement("div");
        card.className = "summary-card";

        const bodyLines = island.questions.map((q, index) => {
          const ans = islandAns[index] ?? "";
          if (!ans.trim()) return `Q${index + 1}. ${q}\n（未入力）\n`;
          return `Q${index + 1}. ${q}\n${ans}\n`;
        });

        card.innerHTML = `
          <div class="summary-title">${island.en}</div>
          <div class="summary-sub">${island.jp}</div>
          <div class="summary-body">${bodyLines.join("\n")}</div>
        `;

        container.appendChild(card);
      });
    }

    /* ------------------------------
       PNG保存（質問画面）
    ------------------------------ */
    async function saveCurrentIslandAsImage() {
      const section = document.getElementById("screen-questions");
      const key = currentIslandKey || "island";
      try {
        const canvas = await html2canvas(section, {
          scale: 2,
          backgroundColor: "#050914"
        });
        canvas.toBlob((blob) => {
          if (!blob) return;
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `selfmap_${key}_summary.png`;
          a.click();
          URL.revokeObjectURL(url);
        });
      } catch (e) {
        alert("画像保存に失敗しました。もう一度お試しください。");
      }
    }

    /* ------------------------------
       イベント設定
    ------------------------------ */
    function setupEvents() {
      document.getElementById("btn-start").addEventListener("click", () => {
        renderMap();
        showScreen("map");
      });

      document
        .getElementById("btn-back-start")
        .addEventListener("click", () => {
          showScreen("start");
        });

      document
        .getElementById("btn-go-summary")
        .addEventListener("click", () => {
          renderSummary();
          showScreen("summary");
        });

      document
        .getElementById("btn-back-map")
        .addEventListener("click", () => {
          renderMap();
          showScreen("map");
        });

      document
        .getElementById("btn-save-image")
        .addEventListener("click", saveCurrentIslandAsImage);

      document
        .getElementById("btn-summary-back-map")
        .addEventListener("click", () => {
          renderMap();
          showScreen("map");
        });

      document
        .getElementById("btn-summary-back-start")
        .addEventListener("click", () => {
          showScreen("start");
        });

      document
        .getElementById("btn-summary-print")
        .addEventListener("click", () => {
          window.print();
        });
    }

    /* ------------------------------
       初期化
    ------------------------------ */
    document.addEventListener("DOMContentLoaded", () => {
      pickRandomQuote();
      renderMap();
      setupEvents();
    });
  </script>
</body>
</html>