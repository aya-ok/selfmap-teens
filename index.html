<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>SelfMap Teens</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ====== 全体レイアウト・テーマ ====== */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2a3a 0, #050810 60%, #020308 100%);
      color: #f5f7ff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    main {
      width: 100%;
      max-width: 960px;
      margin: 32px 16px 64px;
    }
    h1, h2, h3 {
      margin: 0 0 16px;
      text-align: center;
    }
    p {
      line-height: 1.7;
    }
    .center {
      text-align: center;
    }

    /* ====== 画面切り替え ====== */
    .screen {
      display: none;
      padding: 24px;
      border-radius: 16px;
      background: rgba(10, 16, 28, 0.85);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    .screen.active {
      display: block;
    }

    /* ====== 共通ボタン ====== */
    .btn {
      display: inline-block;
      padding: 10px 22px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.04em;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.2s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, #3cc9ff, #38f3d3);
      color: #02131e;
      box-shadow: 0 8px 25px rgba(8, 209, 255, 0.45);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 35px rgba(8, 209, 255, 0.7);
    }
    .btn-secondary {
      background: transparent;
      color: #c5d7ff;
      border: 1px solid rgba(255, 255, 255, 0.22);
    }
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.04);
    }
    .btn-small {
      padding: 6px 14px;
      font-size: 12px;
    }

    /* ====== スタート画面 ====== */
    .start-card {
      max-width: 720px;
      margin: 0 auto;
      padding: 32px 24px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(74, 145, 255, 0.28), rgba(5, 10, 25, 0.9));
      border: 1px solid rgba(255, 255, 255, 0.12);
      text-align: center;
    }
    .subtitle {
      font-size: 14px;
      color: #9fb4ff;
      margin-bottom: 16px;
    }
    .quote {
      font-style: italic;
      font-size: 14px;
      margin-bottom: 12px;
      color: #d9e4ff;
    }
    .quote small {
      display: block;
      margin-top: 4px;
      opacity: 0.8;
    }

    /* ====== マップ画面（島カード） ====== */
    .map-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .island-card {
      background: radial-gradient(circle at top, rgba(53, 120, 255, 0.35), rgba(7, 13, 30, 0.95));
      border-radius: 16px;
      padding: 16px 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border 0.12s ease;
    }
    .island-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.6);
      border-color: rgba(103, 228, 255, 0.65);
    }
    .island-name-en {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #a8c4ff;
      margin-bottom: 4px;
    }
    .island-name-ja {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .island-desc {
      font-size: 12px;
      color: #d0dcff;
      min-height: 32px;
    }
    .progress-pill {
      margin-top: 10px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(5, 15, 40, 0.9);
      border: 1px solid rgba(116, 197, 255, 0.6);
      color: #cfe6ff;
    }
    .progress-bar-outer {
      margin-top: 8px;
      height: 5px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      overflow: hidden;
    }
    .progress-bar-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #3cc9ff, #4dffb0);
      transition: width 0.2s ease;
    }

    /* ====== 質問画面 ====== */
    .questions-header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .questions-subtitle {
      font-size: 13px;
      color: #a8c4ff;
    }
    #questions-list {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .question-block {
      padding: 12px 12px 8px;
      border-radius: 12px;
      background: rgba(8, 14, 30, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .question-label {
      font-size: 13px;
      margin-bottom: 4px;
    }
    .question-help {
      font-size: 11px;
      opacity: 0.7;
      margin-bottom: 6px;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      resize: vertical;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: rgba(5, 10, 22, 0.95);
      color: #f5f7ff;
      font-size: 13px;
      font-family: inherit;
    }
    textarea:focus {
      outline: none;
      border-color: #46d4ff;
      box-shadow: 0 0 0 1px rgba(70, 212, 255, 0.4);
    }

    .questions-footer {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .progress-label {
      font-size: 12px;
      color: #cfe6ff;
    }

    /* ====== まとめ画面 ====== */
    .summary-section {
      margin-top: 16px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.12);
    }
    .summary-section h3 {
      text-align: left;
      font-size: 14px;
      margin-bottom: 8px;
    }
    .summary-list {
      font-size: 12px;
      color: #dde7ff;
      line-height: 1.7;
    }
    .summary-list li {
      margin-bottom: 4px;
    }

    /* ====== 小さい画面対応 ====== */
    @media (max-width: 600px) {
      main {
        margin: 16px 8px 32px;
      }
      .screen {
        padding: 16px;
      }
      .start-card {
        padding: 24px 16px;
      }
    }
  </style>
</head>
<body>
<main>
  <!-- ====== スタート画面 ====== -->
  <section id="screen-start" class="screen active">
    <div class="start-card">
      <h1>SelfMap Teens</h1>
      <p class="subtitle">Know your inner world. / あなたの内側を知る旅</p>
      <p class="quote">
        「千里の道も、一歩から。」<br />
        <small>— 老子</small>
      </p>
      <p>
        このツールは、「自分のこと・未来・なりたい大人像・願い・不安」をゆっくり言葉にしていくための、
        ひとり用RPGノートです。<br />
        思いついたところだけ書いても大丈夫。あとから書き足したり、書き換えたりできます。
      </p>
      <div style="margin-top: 24px" class="center">
        <button id="start-btn" class="btn btn-primary">
          旅を始める（Start Your Journey）
        </button>
      </div>
    </div>
  </section>

  <!-- ====== マップ画面 ====== -->
  <section id="screen-map" class="screen">
    <h2>SelfMap Ocean</h2>
    <p class="center questions-subtitle">
      気になる島から、いつでも好きな順番で上陸してOK。<br />
      すべての島で答え終わると、「旅のまとめ」が開きます。
    </p>
    <div id="map-grid" class="map-grid">
      <!-- JS で島カードを描画 -->
    </div>
    <div class="center" style="margin-top:16px;">
      <button id="to-summary-from-map" class="btn btn-secondary btn-small" style="display:none;">
        旅のまとめを見る
      </button>
    </div>
    <div class="center" style="margin-top:12px;">
      <button id="back-to-start" class="btn btn-secondary btn-small">スタート画面に戻る</button>
    </div>
  </section>

  <!-- ====== 質問画面 ====== -->
  <section id="screen-questions" class="screen">
    <div class="questions-header-top">
      <div>
        <div id="questions-island-en" class="questions-subtitle"></div>
        <h2 id="questions-island-ja"></h2>
      </div>
      <div class="progress-label" id="questions-progress-label"></div>
    </div>
    <p id="questions-island-desc" class="questions-subtitle"></p>

    <div id="questions-list"></div>

    <div class="questions-footer">
      <button id="back-to-map" class="btn btn-secondary btn-small">マップに戻る</button>
      <div class="progress-label" id="questions-done-hint"></div>
    </div>
  </section>

  <!-- ====== 旅のまとめ画面 ====== -->
  <section id="screen-summary" class="screen">
    <h2>旅のまとめ</h2>
    <p class="questions-subtitle center">
      ここにあるのは「いま」の地図です。<br />
      いつでも書き足したり、書き換えたりしてOK。
    </p>
    <div id="summary-content"></div>
    <div class="center" style="margin-top:16px;">
      <button id="back-to-map-from-summary" class="btn btn-secondary btn-small">マップに戻る</button>
    </div>
  </section>
</main>

<script>
  // ========= 設定：島データと質問 =========

  const islands = [
    {
      key: "personal",
      en: "PERSONAL ISLAND",
      ja: "パーソナル島",
      tagline: "Know your inner world. / あなたの内側を知る",
      desc: "自分の性格・クセ・パターンなど、「自分ってこういう人かも？」を見つける島。",
      questions: [
        "あなたにとって自然にできることは？",
        "エネルギーが湧く瞬間は？",
        "どんな場面があなたを疲れさせる？",
        "今日のあなたを一言で表すと？",
        "学ぶのが楽しいことは？",
        "難しいけれど面白いと感じることは？",
        "無意識に避けてしまうものは？",
        "つい最初にやる行動は？",
        "安心できる瞬間は？",
        "少し怖いと感じるものは？",
        "時間を忘れるほど夢中になることは？",
        "思わず笑顔になる瞬間は？",
        "不安を感じるきっかけは？",
        "自分で誇りに思えることは？",
        "許容できる弱さは？",
        "変えたい弱さは？",
        "あなたはどうやって心を回復する？",
        "あなたの決断スタイルは？",
        "今もっとも大事にしていることは？",
        "あなたはどんな人になりつつある？"
      ]
    },
    {
      key: "future",
      en: "FUTURE ISLAND",
      ja: "フューチャー島",
      tagline: "Imagine your path ahead. / 未来の道を思い描く",
      desc: "高校生活・進路・1年後の自分など、これからの道について考える島。",
      questions: [
        "実現できそうな未来は？",
        "ワクワクする未来は？",
        "次の小さな一歩は？",
        "1年後どこにいたい？",
        "高校で挑戦したいことは？",
        "どんな毎日を過ごしたい？",
        "どんな友達と出会いたい？",
        "身につけたいスキルは？",
        "自分に合う環境はどんな場所？",
        "しっくりくる高校のタイプは？",
        "興味がありそうな学部は？",
        "気になる職業は？",
        "避けたい未来は？",
        "未来の自分が感謝する行動は？",
        "努力する価値があるものは？",
        "守りたいものは？",
        "何をつくりたい？",
        "何を残したい？",
        "どんな成長をしたい？",
        "あなたの夢の形は？"
      ]
    },
    {
      key: "adult",
      en: "ADULT ISLAND",
      ja: "アダルト島",
      tagline: "Who is your future self? / 未来の大人像を描く",
      desc: "どんな大人になりたいか、どんな生き方をしたいかを考える島。",
      questions: [
        "あなたを刺激する人は？",
        "その人のどこを尊敬している？",
        "大切にしたい価値観は？",
        "しっくりこない価値観は？",
        "なりたくない大人像は？",
        "どんな存在でありたい？",
        "魅力を感じる生活スタイルは？",
        "身につけたい習慣は？",
        "手放したい習慣は？",
        "人とどう関わりたい？",
        "周りの人にどう感じてほしい？",
        "あなたにとっての“成熟”とは？",
        "強さとは？",
        "優しさとは？",
        "自由とは？",
        "引き受けられる責任は？",
        "貢献したいことは？",
        "大人になった自分が大事にするものは？",
        "大人のあなたは何に笑う？",
        "次のステージのあなたは誰？"
      ]
    },
    {
      key: "wish",
      en: "WISH ISLAND",
      ja: "ウィッシュ島",
      tagline: "What do you hope for? / 願いの島",
      desc: "小さな願いから、ちょっと大きな夢まで、心の「こうなったらいいな」を集める島。",
      questions: [
        "今日の小さな願いは？",
        "高校生活を楽しくする要素は？",
        "声に出しても怖くない夢は？",
        "大きすぎるけれどワクワクする夢は？",
        "何をつくりたい？",
        "どこへ行きたい？",
        "増やしたい瞬間は？",
        "減らしたい瞬間は？",
        "挑戦したい新しいことは？",
        "心に隠している長期の夢は？",
        "未来の自分を驚かせる夢は？",
        "未来の自分を癒す願いは？",
        "人生に美しさをくれるものは？",
        "人生に意味をくれるものは？",
        "今すぐ叶えたい願いは？",
        "いつか叶えばいい願いは？",
        "今は難しそうな願いは？",
        "いつか必ず叶いそうな願いは？",
        "他者とつながる願いは？",
        "あなた“だけ”の願いは？"
      ]
    },
    {
      key: "worry",
      en: "WORRY ISLAND",
      ja: "ウォーリー島",
      tagline: "What shadows follow you? / 影の島",
      desc: "心配ごとや不安を書き出して、「どう付き合うか」を考える島。",
      questions: [
        "今の心配ごとは？",
        "不安のスイッチは？",
        "コントロールできないと感じることは？",
        "避けていることは？",
        "高校への不安は？",
        "未来への不安は？",
        "落ち着く方法は？",
        "必要なサポートは？",
        "最悪のケースは？",
        "最高のケースは？",
        "誤解しているかもしれないことは？",
        "考えすぎていることは？",
        "繰り返している不安のパターンは？",
        "そのパターンを断ち切る方法は？",
        "受け入れられる不安は？",
        "変えられる部分は？",
        "信頼できる相手は？",
        "安心できる場所は？",
        "落ち着かない場所は？",
        "言葉にすると小さくなる恐れは？"
      ]
    }
  ];

  const STORAGE_KEY = "selfmap_teens_answers_v1";
  let answers = loadAnswers();
  let currentIslandKey = null;

  // ========= 初期化 =========
  renderMap();
  updateMapProgress();
  updateSummaryButtonVisibility();
  showScreen("start");

  // ========= 画面切り替え =========
  function showScreen(name) {
    document.querySelectorAll(".screen").forEach((el) => {
      el.classList.remove("active");
    });
    document.getElementById(`screen-${name}`).classList.add("active");
  }

  // ========= localStorage 読み書き =========
  function loadAnswers() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try {
        const parsed = JSON.parse(raw);
        return parsed;
      } catch (e) {
        console.warn("failed to parse storage, reset", e);
      }
    }
    // デフォルト空配列
    const empty = {};
    islands.forEach((island) => {
      empty[island.key] = new Array(island.questions.length).fill("");
    });
    return empty;
  }

  function saveAnswers() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(answers));
    updateMapProgress();
    updateSummaryButtonVisibility();
  }

  // ========= マップ描画・進捗 =========
  function renderMap() {
    const grid = document.getElementById("map-grid");
    grid.innerHTML = "";
    islands.forEach((island) => {
      const card = document.createElement("button");
      card.className = "island-card";
      card.dataset.island = island.key;

      const en = document.createElement("div");
      en.className = "island-name-en";
      en.textContent = island.en;

      const ja = document.createElement("div");
      ja.className = "island-name-ja";
      ja.textContent = island.ja;

      const desc = document.createElement("div");
      desc.className = "island-desc";
      desc.textContent = island.desc;

      const pill = document.createElement("div");
      pill.className = "progress-pill";
      pill.innerHTML = `<span>進捗：</span><span id="pill-${island.key}">0 / ${
        island.questions.length
      }（0%）</span>`;

      const barOuter = document.createElement("div");
      barOuter.className = "progress-bar-outer";
      const barInner = document.createElement("div");
      barInner.className = "progress-bar-inner";
      barInner.id = `bar-${island.key}`;
      barOuter.appendChild(barInner);

      card.appendChild(en);
      card.appendChild(ja);
      card.appendChild(desc);
      card.appendChild(pill);
      card.appendChild(barOuter);

      card.addEventListener("click", () => {
        openIsland(island.key);
      });

      grid.appendChild(card);
    });
  }

  function updateMapProgress() {
    islands.forEach((island) => {
      const ansArr = answers[island.key] || [];
      const total = island.questions.length;
      const done = ansArr.filter((v) => v && v.trim().length > 0).length;
      const percent = Math.round((done / total) * 100);

      const pill = document.getElementById(`pill-${island.key}`);
      const bar = document.getElementById(`bar-${island.key}`);
      if (pill) {
        pill.textContent = `${done} / ${total}（${percent}%）`;
      }
      if (bar) {
        bar.style.width = `${percent}%`;
      }
    });
  }

  function allQuestionsAnswered() {
    return islands.every((island) => {
      const arr = answers[island.key] || [];
      return arr.every((v) => v && v.trim().length > 0);
    });
  }

  function updateSummaryButtonVisibility() {
    const btn = document.getElementById("to-summary-from-map");
    if (!btn) return;
    btn.style.display = allQuestionsAnswered() ? "inline-block" : "none";
  }

  // ========= 島を開く → 質問描画 =========
  function openIsland(key) {
    currentIslandKey = key;
    const island = islands.find((i) => i.key === key);
    if (!island) return;

    document.getElementById("questions-island-en").textContent = island.tagline;
    document.getElementById("questions-island-ja").textContent = island.ja;
    document.getElementById("questions-island-desc").textContent = island.desc;

    renderQuestionsForIsland(island);
    updateQuestionsProgressLabel(island);
    showScreen("questions");
  }

  function renderQuestionsForIsland(island) {
    const container = document.getElementById("questions-list");
    container.innerHTML = "";

    island.questions.forEach((q, index) => {
      const block = document.createElement("div");
      block.className = "question-block";

      const label = document.createElement("div");
      label.className = "question-label";
      label.textContent = `Q${index + 1}. ${q}`;

      const help = document.createElement("div");
      help.className = "question-help";
      help.textContent = "短くても長くてもOK。思いついたことだけ、ゆっくり書いてみよう。";

      const textarea = document.createElement("textarea");
      textarea.value = (answers[island.key] && answers[island.key][index]) || "";
      textarea.addEventListener("input", (e) => {
        if (!answers[island.key]) {
          answers[island.key] = new Array(island.questions.length).fill("");
        }
        answers[island.key][index] = e.target.value;
        saveAnswers();
        updateQuestionsProgressLabel(island);
      });

      block.appendChild(label);
      block.appendChild(help);
      block.appendChild(textarea);
      container.appendChild(block);
    });
  }

  function updateQuestionsProgressLabel(island) {
    const label = document.getElementById("questions-progress-label");
    const hint = document.getElementById("questions-done-hint");
    const arr = answers[island.key] || [];
    const total = island.questions.length;
    const done = arr.filter((v) => v && v.trim().length > 0).length;
    const percent = Math.round((done / total) * 100);

    label.textContent = `回答：${done} / ${total}（${percent}%）`;
    if (percent === 100) {
      hint.textContent = "この島はコンプリート！マップに戻ると宝箱が光ります。";
    } else {
      hint.textContent = "";
    }
  }

  // ========= まとめ画面 =========
  function renderSummary() {
    const container = document.getElementById("summary-content");
    container.innerHTML = "";

    islands.forEach((island) => {
      const section = document.createElement("div");
      section.className = "summary-section";

      const title = document.createElement("h3");
      title.textContent = `${island.ja}（${island.en}）`;
      section.appendChild(title);

      const ul = document.createElement("ul");
      ul.className = "summary-list";

      const arr = answers[island.key] || [];
      island.questions.forEach((q, index) => {
        const v = arr[index];
        if (v && v.trim().length > 0) {
          const li = document.createElement("li");
          li.innerHTML = `<strong>Q${index + 1}:</strong> ${q}<br/> → ${v.replace(
            /\n/g,
            "<br/>"
          )}`;
          ul.appendChild(li);
        }
      });

      if (!ul.children.length) {
        const li = document.createElement("li");
        li.textContent = "まだ書かれていません。あとからいつでも埋められます。";
        ul.appendChild(li);
      }

      section.appendChild(ul);
      container.appendChild(section);
    });
  }

  // ========= イベント設定 =========
  document.getElementById("start-btn").addEventListener("click", () => {
    showScreen("map");
  });

  document.getElementById("back-to-start").addEventListener("click", () => {
    showScreen("start");
  });

  document.getElementById("back-to-map").addEventListener("click", () => {
    showScreen("map");
  });

  document
    .getElementById("to-summary-from-map")
    .addEventListener("click", () => {
      renderSummary();
      showScreen("summary");
    });

  document
    .getElementById("back-to-map-from-summary")
    .addEventListener("click", () => {
      showScreen("map");
    });
</script>
</body>
</html>
